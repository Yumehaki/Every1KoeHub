{% extends "base.html" %}
{% block content %}
<div class="model-header">
  <div class="thumb-lg">
    {% if model.icon_path %}
      <img src="/media/models/{{ model.uuid }}/icon" alt="icon">
    {% else %}
      <img src="/static/defaults/model.svg" alt="icon">
    {% endif %}
  </div>
  <div>
    <h1>
      {{ model.name }}
      {% if model.is_certified %}<img src="/static/defaults/verified.svg" alt="cert" style="width:20px;vertical-align:middle;margin-left:6px">{% endif %}
      {% if model.is_locked %}<img src="/static/defaults/lock.svg" alt="lock" style="width:18px;vertical-align:middle;margin-left:6px">{% endif %}
    </h1>
    <p class="muted">UUID: {{ model.uuid }} ／ 投稿者: <a href="/users/{{ model.author.uuid }}">{{ model.author.username if model.author else "unknown" }}</a></p>
    <p>{{ model.description }}</p>
    <p class="meta">♥ {{ model.likes_count }} ／ ↓ {{ model.downloads }}</p>
  </div>
</div>

<pre class="box">ライセンス名: {{ model.license_name }}
本文:
{{ model.license_text }}</pre>

<p>サイズ: {{ model.size_bytes }} bytes / SHA-256: {{ model.sha256 }}</p>

<p class="btn-row">
  {% if not model.is_locked %}
    <a class="btn" href="/download/{{ model.uuid }}">ダウンロード</a>
  {% else %}
    <button class="btn" disabled title="施錠中のためダウンロード不可">🔒 施錠中</button>
  {% endif %}
  <form method="post" action="/models/{{ model.uuid }}/like" style="display:inline">
    <button class="btn ghost" type="submit">♥ いいね ({{ model.likes_count }})</button>
  </form>
  {% if user and user.uuid == model.user_uuid %}
    <a class="btn ghost" href="/models/{{ model.uuid }}/edit">編集</a>
    <form method="post" action="/models/{{ model.uuid }}/reextract" style="display:inline">
      <button class="btn ghost" type="submit">再抽出</button>
    </form>
    <form method="post" action="/models/{{ model.uuid }}/delete" style="display:inline" onsubmit="return confirm('削除しますか？');">
      <button class="btn ghost" type="submit">削除</button>
    </form>
  {% endif %}
  {% if user and user.is_admin %}
    {% if not model.is_locked %}
      <form method="post" action="/admin/models/{{ model.uuid }}/lock" style="display:inline">
        <button class="btn ghost" type="submit">🔒 施錠</button>
      </form>
    {% else %}
      <form method="post" action="/admin/models/{{ model.uuid }}/unlock" style="display:inline">
        <button class="btn ghost" type="submit">🔓 解除</button>
      </form>
    {% endif %}
    {% if not model.is_certified %}
      <form method="post" action="/admin/models/{{ model.uuid }}/certify" style="display:inline"><button class="btn ghost" type="submit">✔ 認証付与</button></form>
    {% else %}
      <form method="post" action="/admin/models/{{ model.uuid }}/decertify" style="display:inline"><button class="btn ghost" type="submit">✖ 認証解除</button></form>
    {% endif %}
    <form method="post" action="/admin/models/{{ model.uuid }}/delete" style="display:inline" onsubmit="return confirm('運営による完全削除です。よろしいですか？');"><button class="btn ghost" type="submit">🗑 運営削除</button></form>
  {% endif %}
</p>
{% if sample_images and sample_images|length > 0 %}
  <h2>サンプル画像（複数）</h2>
  <div class="card-grid">
    {% for img in sample_images %}
      <div class="card">
        <div class="card-thumb">
          <img src="/media/models/{{ model.uuid }}/samples/{{ img.uuid }}" alt="sample image">
        </div>
        <div class="card-body"><div class="muted">#{{ img.sample_audios }}</div></div>
      </div>
    {% endfor %}
  </div>
{% endif %}

{# 新方式：複数音声 #}
{% if sample_audios and sample_audios|length > 0 %}
  <h2>サンプル音声（複数）</h2>
  <div class="list">
    {% for aui in range(sample_audios.__len__()) %}
      <li class="sample-box"><audio controls src="/media/models/{{ model.uuid }}/samples/{{ sample_audios[aui].uuid }}" style="width:100%"></audio><span class="muted">#{{ aui }}</span></li>
    {% endfor %}
  </div>
{% endif %}

{% if units %}
<h2>所属ユニット</h2>
<div class="chip-row">
  {% for u in units %}
    <a class="chip" href="/units/{{ u.uuid }}">
      {% if u.icon_path %}
        <img src="/media/units/{{ u.uuid }}/icon" alt="">
      {% else %}
        <img src="/static/defaults/unit.svg" alt="">
      {% endif %}
      <span>{{ u.name }}</span>
    </a>
  {% endfor %}
</div>
{% endif %}

<h2>Every1KoeSpeech 互換情報</h2>
<ul class="muted">
  <li>詳細API: <code>/hub/models/{{ model.uuid }}</code></li>
  <li>DL直リンク: <code>/assets/models/{{ model.uuid }}/model.aivmx</code></li>
</ul>
{% endblock %}
